class e extends HTMLElement{constructor(){super(...arguments),this.username="inconnu"}connectedCallback(){var e;this.username=this.getAttribute("username")||"inconnu",this.render(),null===(e=this.querySelector("#header-user"))||void 0===e||e.addEventListener("click",this.toggleUserMenu.bind(this))}disconnectedCallback(){var e;null===(e=this.querySelector("#header-user"))||void 0===e||e.removeEventListener("click",this.toggleUserMenu.bind(this))}toggleUserMenu(e){e.stopPropagation(),this.querySelector(".header-user-menu")?this.hideMenu():this.createUserMenu()}createUserMenu(){var e;const t=document.createElement("div");t.className="header-user-menu",null===(e=this.querySelector("#header-user"))||void 0===e||e.appendChild(t);const s=`<div class="header-user-profile"><img class="header-user-avatar" src="/img/avatar.webp" alt="avatar"><div class="header-user-name"><span>${this.username}</span></div></div>`;t.appendChild((new DOMParser).parseFromString(s,"text/html").body.firstChild);[{text:"Profile",action:()=>this.handleClick("profile")},{text:"Déconnexion",action:()=>this.handleClick("logout")}].forEach(e=>{const s=document.createElement("div");s.className="header-user-item",s.textContent=e.text,s.addEventListener("click",e.action),t.appendChild(s)}),requestAnimationFrame(()=>t.classList.add("show")),this.clickListener=e=>{t.contains(e.target)||this.hideMenu()},document.addEventListener("click",this.clickListener,{once:!0})}hideMenu(){const e=this.querySelector(".header-user-menu");e&&(e.classList.remove("show"),e.classList.add("hide"),setTimeout(()=>e.remove(),300)),this.clickListener&&(document.removeEventListener("click",this.clickListener),this.clickListener=void 0)}handleClick(e){switch(e){case"profile":window.location.href="/profile";break;case"logout":window.location.href="/login"}this.hideMenu()}render(){this.innerHTML='<div id="header-user" class="header-user"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="32" viewBox="0 0 448 512"><path fill="currentColor" d="M224 256a128 128 0 1 0 0-256a128 128 0 1 0 0 256m-96 55.2C54 332.9 0 401.3 0 482.3C0 498.7 13.3 512 29.7 512h388.6c16.4 0 29.7-13.3 29.7-29.7c0-81-54-149.4-128-171.1V362c27.6 7.1 48 32.2 48 62v40c0 8.8-7.2 16-16 16h-16c-8.8 0-16-7.2-16-16s7.2-16 16-16v-24c0-17.7-14.3-32-32-32s-32 14.3-32 32v24c8.8 0 16 7.2 16 16s-7.2 16-16 16h-16c-8.8 0-16-7.2-16-16v-40c0-29.8 20.4-54.9 48-62v-57.1q-9-.9-18.3-.9h-91.4q-9.3 0-18.3.9v65.4c23.1 6.9 40 28.3 40 53.7c0 30.9-25.1 56-56 56s-56-25.1-56-56c0-25.4 16.9-46.8 40-53.7zM144 448a24 24 0 1 0 0-48a24 24 0 1 0 0 48"/></svg></div>'}}class t extends HTMLElement{constructor(){super(...arguments),this.sortByField=null,this.sort="asc",this.name=null,this.down='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 448 512"><path fill="currentColor" d="M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7L86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"/></svg>',this.up='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 448 512"><path fill="currentColor" d="M201.4 137.4c12.5-12.5 32.8-12.5 45.3 0l160 160c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L224 205.3L86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l160-160z"/></svg>',this.handleClick=()=>{const e=new URLSearchParams(window.location.search),t=e.get("sort")||"asc";this.sort="asc"===t?"desc":"asc",e.set("sort",this.sort),e.set("sortBy",this.sortByField||"lastName"),e.set("page","1"),window.location.search=e.toString()}}connectedCallback(){this.sortByField=this.getAttribute("sortby"),this.name=this.getAttribute("name"),this.sortByField&&this.name&&(this.addListeners(),this.render())}disconnectedCallback(){this.removeListeners()}addListeners(){this.addEventListener("click",this.handleClick);const e=new URLSearchParams(window.location.search);this.sort="desc"===e.get("sort")?"desc":"asc"}removeListeners(){this.removeEventListener("click",this.handleClick)}render(){this.innerHTML=`${this.name}<span>${"asc"===this.sort?this.down:this.up}</span>`}}function s(e,t,s,i){return new(s||(s=Promise))(function(n,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}c((i=i.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;class i extends HTMLElement{constructor(){super(),this.searchLock=!1,this.boundHandleKeydown=this.handleKeydown.bind(this),this.boundToggleSearchForm=this.toggleSearchForm.bind(this),this.boundHandleOutsideClick=this.handleOutsideClick.bind(this)}connectedCallback(){this.render(),this.addListeners()}disconnectedCallback(){this.removeListeners(),this.debounceTimer&&(window.clearTimeout(this.debounceTimer),this.debounceTimer=void 0)}addListeners(){var e;document.addEventListener("keydown",this.boundHandleKeydown),null===(e=this.querySelector("#header-search"))||void 0===e||e.addEventListener("click",this.boundToggleSearchForm)}removeListeners(){var e;document.removeEventListener("keydown",this.boundHandleKeydown),null===(e=this.querySelector("#header-search"))||void 0===e||e.removeEventListener("click",this.boundToggleSearchForm)}handleKeydown(e){(e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),this.toggleSearchForm())}toggleSearchForm(){const e=document.body.querySelector(".search-container");e?(this.hideSearchForm(e),document.removeEventListener("mousedown",this.boundHandleOutsideClick)):(this.createSearchForm(),document.addEventListener("mousedown",this.boundHandleOutsideClick))}hideSearchForm(e){const t=e.querySelector("#search-input");t&&this.inputListener&&t.removeEventListener("input",this.inputListener);e.animate([{opacity:1,transform:"translateY(0)"},{opacity:0,transform:"translateY(-200px)"}],{duration:300,easing:"ease-in-out",fill:"forwards"}).onfinish=()=>{e.remove(),document.removeEventListener("mousedown",this.boundHandleOutsideClick)}}createSearchForm(){const e=document.createElement("div");e.className="search-container",e.innerHTML='<div class="search-form"><input id="search-input" type="text" placeholder="Rechercher un patient ..." class="search-input" aria-label="Recherche patient" role="searchbox"><span id="clear-form" title="Effacer la recherche"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 384 512"><path fill="currentColor" d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7L86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256L41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3l105.4 105.3c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256z"/></svg></span></div><ul id="search-results" class="search-results" role="listbox" aria-label="Résultats de recherche"></ul>',document.body.appendChild(e),this.clearButton(e),this.searchListener(e);const t=e.querySelector("#search-input");t.addEventListener("keydown",this.handleNavigation.bind(this,e)),requestAnimationFrame(()=>{e.classList.add("show"),t.focus()})}searchListener(e){const t=e.querySelector("#search-input");t&&(this.inputListener=t=>{const s=t.target.value.trim(),i=e.querySelector("#search-results");if(!this.searchLock){if(i){this.searchLock=!0;i.animate([{opacity:1,transform:"translateY(0)"},{opacity:0,transform:"translateY(-20px)"}],{duration:300,easing:"ease-in-out",fill:"forwards"}).onfinish=()=>{this.searchLock=!1,i.innerHTML=""}}this.debounceTimer&&window.clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>!this.searchLock&&s.length>0&&this.searchPatients(s),1e3)}},t.addEventListener("input",this.inputListener))}searchPatients(e){return s(this,void 0,void 0,function*(){try{const t=yield fetch(`/api/patients/search?q=${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`Erreur HTTP: ${t.status}`);const s=yield t.json(),i=document.body.querySelector("#search-results");if(i){i.innerHTML="",s.data.forEach(e=>{const t=document.createElement("li");t.className="search-item",t.textContent=`${e.lastName} ${e.firstName}`,t.setAttribute("role","option"),t.tabIndex=-1,t.addEventListener("click",()=>{window.location.href=`/patient/${e.id}`}),i.appendChild(t)});const e=i.querySelector("li");e&&e.classList.add("selected"),i.animate([{opacity:0,transform:"translateY(-20px)"},{opacity:1,transform:"translateY(0)"}],{duration:300,easing:"ease-in-out",fill:"forwards"})}}catch(e){}})}handleNavigation(e,t){const s=e.querySelectorAll("#search-results li");if(!s.length)return;let i=Array.from(s).findIndex(e=>e.classList.contains("selected"));switch(t.key){case"ArrowDown":t.preventDefault(),i=i<s.length-1?i+1:0;break;case"ArrowUp":t.preventDefault(),i=i>0?i-1:s.length-1;break;case"Enter":return void(i>=0&&(t.preventDefault(),s[i].click()));default:return}s.forEach(e=>e.classList.remove("selected"));const n=s[i];n.classList.add("selected"),n.scrollIntoView({block:"nearest"})}clearButton(e){const t=e.querySelector("#clear-form"),s=e.querySelector("#search-input");t&&s&&t.addEventListener("click",()=>{s.value="",s.focus();const t=e.querySelector("#search-results");t&&(t.innerHTML="")})}handleOutsideClick(e){const t=document.body.querySelector(".search-container"),s=this.querySelector("#header-search");t&&!t.contains(e.target)&&s&&!s.contains(e.target)&&this.hideSearchForm(t)}render(){this.innerHTML='<div id="header-search" class="header-search" tabindex="0" aria-label="Ouvrir la recherche"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 512 512"><path fill="currentColor" d="M416 208c0 45.9-14.9 88.3-40 122.7l126.6 126.7c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0s208 93.1 208 208M208 352a144 144 0 1 0 0-288a144 144 0 1 0 0 288"/></svg></div>'}}class n extends HTMLElement{constructor(){super(...arguments),this.onInput=e=>{const t=e.target;this.autoResizeTextarea(t)}}connectedCallback(){this.addListeners()}addListeners(){var e;null===(e=this.querySelector("textarea"))||void 0===e||e.addEventListener("input",this.onInput)}removeListeners(){var e;null===(e=this.querySelector("textarea"))||void 0===e||e.removeEventListener("input",this.onInput)}autoResizeTextarea(e){e.style.height="auto",e.style.height=e.scrollHeight+"px"}}class r extends HTMLElement{constructor(){super(...arguments),this.editing=!1,this.open=!1,this.csrf=null,this.patientId=null,this.noteId=null,this.body=null,this.form=null,this.onBodyClick=e=>{if(this.open&&this.editing)return;const t=e.target;return t.closest(".timeline-edit")?(e.stopPropagation(),void this.startEditing()):t.closest(".timeline")?(e.stopPropagation(),void this.toggleOpen()):void this.closeAllNotes()},this.onBodyClickOutside=e=>{e.target.closest(".timeline")||(this.editing&&this.removeForm(),this.editing=!1,this.closeAllNotes())}}static get observedAttributes(){return["open"]}attributeChangedCallback(e,t,s){this.removeForm(),"open"===e&&(this.open="true"===s,this.updateBodyState())}connectedCallback(){this.open="true"===this.getAttribute("open"),this.csrf=this.getAttribute("csrf"),this.patientId=this.getAttribute("patientId"),this.noteId=this.getAttribute("noteId"),this.body=this.querySelector(".timeline-body"),this.updateBodyState(),this.addListeners()}disconnectedCallback(){this.removeListeners()}addListeners(){this.addEventListener("click",this.onBodyClick),document.addEventListener("click",this.onBodyClickOutside),window.addEventListener("resize",this.closeAllNotes)}removeListeners(){this.removeEventListener("click",this.onBodyClick),document.removeEventListener("click",this.onBodyClickOutside),window.removeEventListener("resize",this.closeAllNotes)}startEditing(){var e,t;this.closeAllNotes();const s=this.querySelector(".timeline-body p");this.open=!0,this.editing=!0,this.setAttribute("open","true"),this.form=document.createElement("form"),this.form.id="form-timeline-edit",this.form.method="post",this.form.action=`/note/${this.noteId}`;const i=document.createElement("input");i.type="hidden",i.name="_method",i.value="PUT";const n=document.createElement("input");n.type="hidden",n.name="patient",n.value=null!==(e=this.patientId)&&void 0!==e?e:"";const r=document.createElement("input");r.type="hidden",r.name="_csrf",r.value=null!==(t=this.csrf)&&void 0!==t?t:"";const o=document.createElement("textarea");o.name="note",o.className="timeline-editing",o.value=(null==s?void 0:s.textContent)||"",o.minLength=10,o.maxLength=1e3,o.required=!0;const a=document.createElement("button");a.type="submit",a.className="btn positive",a.textContent="Sauvegarder",this.form.append(i,n,r,o,a),null==s||s.replaceWith(this.form),o.focus(),this.autoResizeTextarea(o),o.addEventListener("input",()=>this.autoResizeTextarea(o))}autoResizeTextarea(e){e.style.height="auto",e.style.height=e.scrollHeight+"px"}toggleOpen(){this.open=!this.open,this.setAttribute("open",String(this.open)),this.closeOtherNotes()}closeOtherNotes(){document.querySelectorAll("timeline-component").forEach(e=>e!==this&&e.open&&e.setAttribute("open","false"))}closeAllNotes(){document.querySelectorAll("timeline-component").forEach(e=>e.setAttribute("open","false"))}updateBodyState(){this.body&&this.body.classList.toggle("active",this.open)}removeForm(){const e=this.querySelector("#form-timeline-edit");if(e){const t=e.querySelector("textarea"),s=(null==t?void 0:t.value)||"",i=document.createElement("p");i.textContent=s,e.replaceWith(i)}}}class o extends HTMLElement{constructor(){super(...arguments),this.totalElements=null,this.currentPage=null,this.totalPages=null,this.pageSize=null,this.onPrevClick=()=>{if(null!==this.currentPage){const e=new URLSearchParams(window.location.search);e.set("page",String(this.currentPage-1)),window.location.search=e.toString()}},this.onNextClick=()=>{if(null!==this.currentPage){const e=new URLSearchParams(window.location.search);e.set("page",String(this.currentPage+1)),window.location.search=e.toString()}},this.onPageSizeChange=e=>{const t=e.target,s=parseInt(t.value,10);if(null!==this.pageSize&&s!==this.pageSize){const e=new URLSearchParams(window.location.search);e.set("size",String(s)),window.location.search=e.toString()}}}connectedCallback(){const e=this.getAttribute("total-elements");this.totalElements=e?parseInt(e,10):null;const t=this.getAttribute("current-page");this.currentPage=t?parseInt(t,10):null;const s=this.getAttribute("total-pages");this.totalPages=s?parseInt(s,10):null;const i=this.getAttribute("page-size");this.pageSize=i?parseInt(i,10):null,this.render(),this.addListeners()}disconnectedCallback(){this.removeListeners()}addListeners(){var e,t,s;null===(e=this.querySelector("#prev-button"))||void 0===e||e.addEventListener("click",this.onPrevClick),null===(t=this.querySelector("#next-button"))||void 0===t||t.addEventListener("click",this.onNextClick),null===(s=this.querySelector("#page-size"))||void 0===s||s.addEventListener("change",this.onPageSizeChange)}removeListeners(){var e,t,s;null===(e=this.querySelector("#prev-button"))||void 0===e||e.removeEventListener("click",this.onPrevClick),null===(t=this.querySelector("#next-button"))||void 0===t||t.removeEventListener("click",this.onNextClick),null===(s=this.querySelector("#page-size"))||void 0===s||s.removeEventListener("change",this.onPageSizeChange)}render(){const e=1===this.currentPage?"disabled":"",t=this.currentPage===this.totalPages?"disabled":"",s=5===this.pageSize?"selected":"",i=10===this.pageSize?"selected":"",n=20===this.pageSize?"selected":"",r=50===this.pageSize?"selected":"",o=null!==this.totalElements&&null!==this.pageSize&&null!==this.currentPage?Math.min(this.currentPage*this.pageSize,this.totalElements):"-",a=null!==this.totalPages&&null!==this.pageSize?this.totalPages*this.pageSize:"-";this.innerHTML=`<div class="page-size"><span>Éléments par page</span><select id="page-size"><option value="5" ${s}>5</option><option value="10" ${i}>10</option><option value="20" ${n}>20</option><option value="50" ${r}>50</option></select></div><div class="pagination"><div>${o} <span>sur ${a}</span></div><div class="group-btn"><button id="prev-button" ${e}><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 512 512"><path fill="currentColor" d="M512 256a256 256 0 1 0-512 0a256 256 0 1 0 512 0M271 135c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-87 87l87 87c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0L167 273c-9.4-9.4-9.4-24.6 0-33.9z"/></svg></button><button id="next-button" ${t}><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 512 512"><path fill="currentColor" d="M0 256a256 256 0 1 0 512 0a256 256 0 1 0-512 0m241 121c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l87-87l-87-87c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0L345 239c9.4 9.4 9.4 24.6 0 33.9z"/></svg></button></div></div>`}}customElements.define("user-component",e),customElements.define("sort-component",t),customElements.define("search-component",i),customElements.define("textarea-component",n),customElements.define("timeline-component",r),customElements.define("pagination-component",o);
